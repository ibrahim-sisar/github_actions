name: Discord Notification on File Change

on:
  push:
    branches:
      - main  # ูุชู ุชุดุบููู ุนูุฏ ุฃู ุชุนุฏูู ุนูู ุงููุฑุน ุงูุฑุฆูุณู

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4  # ุฅุญุถุงุฑ ุงูููุฏ

      - name: Get Changed Files
        id: changed-files
        run: |
          FILES=$(git diff --name-only HEAD~1)
          echo "FILES=$FILES" >> $GITHUB_ENV

      - name: Send Notification to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_AUTHOR: ${{ github.actor }}
          COMMIT_TIMESTAMP: ${{ github.event.head_commit.timestamp }}
          FILES_CHANGED: ${{ env.FILES }}
        run: |
          # ุงุณุชุจุฏุงู ุงูุณุทูุฑ ุงูุฌุฏูุฏุฉ ุจููุงุตู ูุฅูุดุงุก ูุงุฆูุฉ ูููุงุช ูุธููุฉ
          FILES_FORMATTED=$(echo "$FILES_CHANGED" | tr '\n' ',')

          # ุฅุฐุง ูู ููู ููุงู ูููุงุช ูุนุฏูุฉุ ูุง ุชุฑุณู ุฑุณุงูุฉ
          if [[ -z "$FILES_CHANGED" ]]; then
            echo "No files changed, skipping Discord notification."
            exit 0
          fi

          # ุฅุนุฏุงุฏ ุจูุงูุงุช JSON
          PAYLOAD=$(jq -n \
            --arg author "$COMMIT_AUTHOR" \
            --arg files "$FILES_FORMATTED" \
            --arg time "$COMMIT_TIMESTAMP" \
            '{username: "GitHub Actions", content: ("๐ **ุชู ุชุนุฏูู ูููุงุช!**\n๐ค **ุงููุณุชุฎุฏู:** " + $author + "\n๐ **ุงููููุงุช ุงููุนุฏูุฉ:** ```" + $files + "``` \nโฐ **ุงูููุช:** " + $time)}')

          # ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Discord
          curl -X POST -H "Content-Type: application/json" -d "$PAYLOAD" "$DISCORD_WEBHOOK_URL"
